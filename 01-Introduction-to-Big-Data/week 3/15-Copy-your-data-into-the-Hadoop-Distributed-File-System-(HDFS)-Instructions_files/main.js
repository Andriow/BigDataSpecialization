define("pages/open-course/peerReview/comments/views/main",["require","exports","module","bundles/phoenix/lib/view","underscore","pages/open-course/common/models/currentSocialProfile","pages/open-course/peerReview/comments/viewModels/main","pages/open-course/peerReview/comments/views/feedbackCollection","pages/open-course/peerReview/comments/views/main.html","js/vendor/backbone.stickit.v0-8-0"],function(require,exports,module){"use strict";var t=require("bundles/phoenix/lib/view"),_=require("underscore"),s=require("pages/open-course/common/models/currentSocialProfile"),o=require("pages/open-course/peerReview/comments/viewModels/main"),i=require("pages/open-course/peerReview/comments/views/feedbackCollection"),n=require("pages/open-course/peerReview/comments/views/main.html");require("js/vendor/backbone.stickit.v0-8-0");var e=function getMetadata(e){return function(){return this.itemMetadata.get(e)}},a=t.extend({name:"mainFeedbackView",template:n,events:{'submit [data-js="form"]':"submit"},classes:{hasFeedback:"c-peer-review-feedback-textarea-has-feedback"},dom:{textarea:'[data-js="textarea"]'},multitracker:{namespace:"",baseValues:["open_course_id","module_id","lesson_id","item_id","submission_id"],definitions:{open_course_id:e("course.id"),module_id:e("lesson.module.id"),lesson_id:e("lesson.id"),item_id:e("id"),submission_id:function submission_id(){return this.submissionId}},events:{"click.post":[]}},initialize:function initialize(e){this.initializeOptions(e),this.initializeViewModel(),this.multitracker=_({}).extend(this.multitracker,{namespace:this.eventPrefix})},initializeOptions:function initializeOptions(e){this.eventPrefix=e.eventPrefix,this.api=e.api,this.itemMetadata=e.itemMetadata,this.submissionId=e.submissionId,this.feedbackCollection=e.model,this.likeModel=e.likeModel},initializeViewModel:function initializeViewModel(){this.viewModel=new o({api:this.api,itemMetadata:this.itemMetadata,submissionId:this.submissionId,feedbackCollection:this.feedbackCollection}),this.viewModel.fetch(),this.listenTo(this.viewModel,"state:change",this.renderState),this.listenTo(this.viewModel,"state:change",this.updateInputs),this.listenTo(this.viewModel,"feedback-added",function(e){this.track("click.post",{comment_user_id:e.get("creator").get("userId"),comment:e.get("comment")})}),this.listenTo(this.viewModel.feedbackInputModel,"change",this.renderPostButtonVisibility)},submit:function submit(e){e.preventDefault(),this.viewModel.submit()},state:function state(){return this.viewModel.state()},render:function render(){return this.$el.html(this.template({currentSocialProfile:s})),this.renderFsm(),this.renderState(),this.stickit(this.viewModel.feedbackInputModel,_.object([this.dom.textarea],["comment"])),this.appendSubview(),this.renderPostButtonVisibility(),this},renderPostButtonVisibility:function renderPostButtonVisibility(){var e=!!this.viewModel.feedbackInputModel.get("comment");this.$$("post-feedback").toggle(e),this.$$("textarea").toggleClass(this.classes.hasFeedback,e)},appendSubview:function appendSubview(){this.region.append(i,{to:this.$$("container"),initialize:{collection:this.viewModel.feedbackCollection},module:i})},updateInputs:function updateInputs(){this.$(this.dom.textarea).attr("disabled",this.viewModel.isState("submitting"))}});module.exports=a});