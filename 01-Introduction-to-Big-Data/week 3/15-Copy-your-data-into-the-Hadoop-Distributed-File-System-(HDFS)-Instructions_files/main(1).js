define("pages/open-course/peerReview/comments/viewModels/main",["require","exports","module","js/lib/fsm","backbone","underscore","pages/open-course/common/models/currentSocialProfile","pages/open-course/peerReview/comments/models/feedback"],function(require,exports,module){"use strict";var e=require("js/lib/fsm"),Backbone=require("backbone"),_=require("underscore"),t=require("pages/open-course/common/models/currentSocialProfile"),i=require("pages/open-course/peerReview/comments/models/feedback"),o=Backbone.Model.extend(_.extend({},e.FiniteStateMachine,{defaults:{state:"nothing"},fsm:{states:["nothing","loading","load-error","ready","submitting","submit-error"],transitions:{loading:["nothing"],ready:["loading","submitting"],"load-error":["loading"],submitting:["ready","submit-error"],"submit-error":["submitting"]}},initialize:function initialize(e){_.bindAll(this,"onFetchSuccess","onFetchError","onSubmitSuccess","onSubmitError"),this.initializeOptions(e),this.initializeContentModels()},initializeOptions:function initializeOptions(e){this.api=e.api,this.itemMetadata=e.itemMetadata,this.submissionId=e.submissionId,this.feedbackCollection=e.feedbackCollection},initializeContentModels:function initializeContentModels(){this.feedbackInputModel=new i,this.feedbackInputModel.clear()},fetch:function fetch(){this.transition("loading"),this.feedbackCollection.fetch(this.api,this.itemMetadata,this.submissionId).then(this.onFetchSuccess,this.onFetchError).done()},submit:function submit(){this.transition("submitting"),this.feedbackInputModel.submit(this.api,this.itemMetadata,this.submissionId).then(this.onSubmitSuccess,this.onSubmitError).done()},onFetchSuccess:function onFetchSuccess(){this.transition("ready")},onFetchError:function onFetchError(e){this.transition("load-error"),console.error(e)},onSubmitSuccess:function onSubmitSuccess(){var e=this.feedbackInputModel.clone().set({creator:t.clone(),createdAt:Date.now()});this.transition("ready"),this.trigger("feedback-added",e),this.feedbackCollection.add(e,{at:0}),this.feedbackInputModel.clear()},onSubmitError:function onSubmitError(e){this.transition("submit-error"),console.error(e)}}));module.exports=o});