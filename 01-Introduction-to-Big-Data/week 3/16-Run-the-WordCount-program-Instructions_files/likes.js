define("pages/open-course/peerReview/components/likes/models/likes",["require","exports","module","js/lib/assert","js/lib/fsm","backbone","q","underscore"],function(require,exports,module){"use strict";var e=require("js/lib/assert"),t=require("js/lib/fsm"),Backbone=require("backbone"),i=require("q"),_=require("underscore"),s=Backbone.Model.extend(_.extend({},t.FiniteStateMachine,{fsm:{states:["updating","up-to-date","update-error"],transitions:{updating:["up-to-date","update-error"],"up-to-date":["updating"],"update-error":["updating"]}},defaults:{likes:0,state:"up-to-date",userHasLiked:!1},initialize:function initialize(i){this.api=i.api;var t=["like","unlike"];t.forEach(function(i){e(_.contains(_.functions(this.api),i),"API passed into like model does not contain required method "+i)}.bind(this)),_.bindAll(this,"onLikeSuccess","onLikeFailure","onUnlikeSuccess","onUnlikeFailure")},like:function like(){if(!this.isState("up-to-date","update-error"))return i();return this.transition("updating"),this._applyLike(),this.api.like().then(this.onLikeSuccess,this.onLikeFailure)},onLikeSuccess:function onLikeSuccess(){this.trigger("liked"),this.transition("up-to-date")},onLikeFailure:function onLikeFailure(){this._applyUnlike(),this.transition("update-error")},unlike:function unlike(){if(!this.isState("up-to-date","update-error"))return i();return this.transition("updating"),this._applyUnlike(),this.api.unlike().then(this.onUnlikeSuccess,this.onUnlikeFailure)},onUnlikeSuccess:function onUnlikeSuccess(){this.trigger("unliked"),this.transition("up-to-date")},onUnlikeFailure:function onUnlikeFailure(){this._applyLike(),this.transition("update-error")},toggleLike:function toggleLike(){return this.get("userHasLiked")?this.unlike():this.like()},_applyLike:function _applyLike(){this.set("likes",this.get("likes")+1),this.set("userHasLiked",!0)},_applyUnlike:function _applyUnlike(){this.set("likes",this.get("likes")-1),this.set("userHasLiked",!1)}}));module.exports=s});