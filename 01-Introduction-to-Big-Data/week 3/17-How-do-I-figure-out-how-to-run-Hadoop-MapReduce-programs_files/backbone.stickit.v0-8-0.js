!function(t){"function"==typeof define&&define.amd?define("js/vendor/backbone.stickit.v0-8-0",["underscore","backbone","exports"],t):"object"==typeof exports?t(require("underscore"),require("backbone"),exports):t(_,Backbone,{})}(function(_,Backbone,e){e._handlers=[],e.addHandler=function(t){t=_.map(_.flatten([t]),function(t){return _.extend({updateModel:!0,updateView:!0,updateMethod:"text"},t)}),this._handlers=this._handlers.concat(t)},e.ViewMixin={_modelBindings:null,unstickit:function(t,e){if(_.isObject(e))return void _.each(_.keys(e),function(e){this.unstickit(t,e)},this);var n=[],i=[];_.each(this._modelBindings,function(a,o){if(t&&a.model!==t)return;if(e&&a.config.selector!=e)return;i.push(a.config._destroy),a.model.off(a.event,a.fn),n.push(a.model),delete this._modelBindings[o]},this),_.invoke(_.uniq(n),"trigger","stickit:unstuck",this.cid),_.each(_.uniq(i),function(t){t.call(this)},this),this._modelBindings=_.compact(this._modelBindings),this.$el.off(".stickit"+(t?"."+t.cid:""),e)},stickit:function(e,n){var i=e||this.model,a=n||_.result(this,"bindings")||{};this._modelBindings||(this._modelBindings=[]),this.addBinding(i,a);var t=this.remove;t.stickitWrapped||(this.remove=function(){var e=this;return this.unstickit(),t&&(e=t.apply(this,arguments)),e}),this.remove.stickitWrapped=!0},addBinding:function(x,v,y){var r,g,h,e,p,n=x||this.model,k=".stickit."+n.cid,f=y||{},b=_.uniqueId();if(!_.isString(v)){var m=v;return void _.each(m,function(e,t){this.addBinding(n,t,m[t])},this)}if(p=v,r=":el"===p?this.$el:this.$(p),this.unstickit(n,p),!r.length)return;_.isString(f)&&(f={observe:f}),_.isFunction(f.observe)&&(f.observe=f.observe.call(this)),e=u(r,f),e.selector=p,h=e.observe,e.bindId=b,e.view=this,g=_.extend({stickitChange:e},e.setOptions),e._destroy=function(){t(this,e.destroy,r,n,e)},c(this,r,e,n,h),l(this,r,e,n,h),h&&(_.each(e.events,function(a){var i=a+k,t=function(t){var i=e.getVal.call(this,r,t,e,_.rest(arguments));s(this,e.updateModel,i,t,e)&&d(n,h,i,g,this,e)};t=_.bind(t,this),":el"===p?this.$el.on(i,t):this.$el.on(i,p,t)},this),_.each(_.flatten([h]),function(t){a(n,this,"change:"+t,e,function(n,s,t){var a=t&&t.stickitChange&&t.stickitChange.bindId||null;a!==b&&o(this,r,e,i(n,h,e,this),n)})},this),o(this,r,e,i(n,h,e,this),n,!0)),t(this,e.initialize,r,n,e)}},_.extend(Backbone.View.prototype,e.ViewMixin);var n=function(t,n){var i=(n||"").split("."),e=_.reduce(i,function(t,e){return t[e]},t);return null==e?t:e},t=function(e,t){if(t)return(_.isString(t)?n(e,t):t).apply(e,_.rest(arguments,2))},r=function(t){return t.find("option").not(function(){return!this.selected})},s=function(n,e){if(_.isBoolean(e))return e;if(_.isFunction(e)||_.isString(e))return t.apply(this,arguments);return!1},a=function(t,e,n,a,i){t.on(n,i,e),e._modelBindings.push({model:t,event:n,fn:i,config:a})},d=function(s,i,e,o,r,n){var a={};n.onSet&&(e=t(r,n.onSet,e,n)),n.set?t(r,n.set,i,e,o,n):(a[i]=e,_.isArray(i)&&_.isArray(e)&&(a=_.reduce(i,function(t,i,n){return t[i]=_.has(e,n)?e[n]:null,t},{})),s.set(a,o))},i=function(r,i,n,s){var e,a=function(t){return r[n.escape?"escape":"get"](t)},o=function(t){return null==t?"":t};return e=_.isArray(i)?_.map(i,a):a(i),n.onGet&&(e=t(s,n.onGet,e,n)),_.isArray(e)?_.map(e,o):o(e)},u=e.getConfiguration=function(i,a){var n=[{updateModel:!1,updateMethod:"text",update:function(t,n,i,e){t[e.updateMethod]&&t[e.updateMethod](n)},getVal:function(t,n,e){return t[e.updateMethod]()}}];n=n.concat(_.filter(e._handlers,function(t){return i.is(t.selector)})),n.push(a);var t=_.extend.apply(_,n);return t.visible&&!_.has(t,"updateView")?t.updateView=!1:_.has(t,"updateView")||(t.updateView=!0),t},c=function(t,e,n,o,r){var s=["autofocus","autoplay","async","checked","controls","defer","disabled","hidden","indeterminate","loop","multiple","open","readonly","required","scoped","selected"];_.each(n.attributes||[],function(u){var d="",c,l;u=_.clone(u),c=u.observe||(u.observe=r),l=function(){var a=_.indexOf(s,u.name,!0)>-1?"prop":"attr",n=i(o,c,u,t);"class"===u.name?(e.removeClass(d).addClass(n),d=n):e[a](u.name,n)},_.each(_.flatten([c]),function(e){a(o,t,"change:"+e,n,l)}),l()})},l=function(n,o,e,r,s){if(null==e.visible)return;var u=function(){var a=e.visible,c=e.visibleFn,l=i(r,s,e,n),u=!!l;(_.isFunction(a)||_.isString(a))&&(u=!!t(n,a,l,e)),c?t(n,c,o,u,e):o.toggle(u)};_.each(_.flatten([s]),function(t){a(r,n,"change:"+t,e,u)}),u()},o=function(n,a,e,i,o,r){if(!s(n,e.updateView,i,e))return;t(n,e.update,a,i,o,e),r||t(n,e.afterUpdate,a,i,e)};return e.addHandler([{selector:'[contenteditable="true"]',updateMethod:"html",events:["input","change"]},{selector:"input",events:["propertychange","input","change"],update:function(t,e){t.val(e)},getVal:function(t){return t.val()}},{selector:"textarea",events:["propertychange","input","change"],update:function(t,e){t.val(e)},getVal:function(t){return t.val()}},{selector:'input[type="radio"]',events:["change"],update:function(t,e){t.filter('[value="'+e+'"]').prop("checked",!0)},getVal:function(t){return t.filter(":checked").val()}},{selector:'input[type="checkbox"]',events:["change"],update:function(e,t,i,a){if(e.length>1)t||(t=[]),e.each(function(a,n){var e=Backbone.$(n),i=_.indexOf(t,e.val())>-1;e.prop("checked",i)});else{var n=_.isBoolean(t)?t:t===e.val();e.prop("checked",n)}},getVal:function(t){var e;if(t.length>1)e=_.reduce(t,function(t,n){var e=Backbone.$(n);return e.prop("checked")&&t.push(e.val()),t},[]);else{e=t.prop("checked");var n=t.val();"on"!==n&&null!=n&&(e=e?t.val():null)}return e}},{selector:"select",events:["change"],update:function(i,u,v,d){var a,e=d.selectOptions,o=e&&e.collection||void 0,p=i.prop("multiple");if(!e){e={};var c=function(t){return t.map(function(){return{value:this.value,label:this.text}}).get()};i.find("optgroup").length?(o={opt_labels:[]},i.find("> option").length&&(o.opt_labels.push(void 0),_.each(i.find("> option"),function(t){o[void 0]=c(Backbone.$(t))})),_.each(i.find("optgroup"),function(t){var e=Backbone.$(t).attr("label");o.opt_labels.push(e),o[e]=c(Backbone.$(t).find("option"))})):o=c(i.find("option"))}e.valuePath=e.valuePath||"value",e.labelPath=e.labelPath||"label";var s=function(i,a,t){_.each(i,function(r){var o=Backbone.$("<option/>"),i=r,s=function(t,e){o.text(t),i=e,o.data("stickit_bind_val",i),_.isArray(i)||_.isObject(i)||o.val(i)};"__default__"===r?s(e.defaultOption.label,e.defaultOption.value):s(n(r,e.labelPath),n(r,e.valuePath)),!p&&null!=i&&null!=t&&i===t||_.isObject(t)&&_.isEqual(i,t)?o.prop("selected",!0):p&&_.isArray(t)&&_.each(t,function(t){_.isObject(t)&&(t=n(t,e.valuePath)),(t===i||_.isObject(t)&&_.isEqual(i,t))&&o.prop("selected",!0)}),a.append(o)})};i.find("*").remove();var f=function(i,t){var e=window;return 0===t.indexOf("this.")&&(e=i),t=t.replace(/^[a-z]*\.(.+)$/,"$1"),n(e,t)};if(a=_.isString(o)?f(this,o):_.isFunction(o)?t(this,o,i,d):o,a instanceof Backbone.Collection&&(a=a.toJSON()),e.defaultOption&&s(["__default__"],i),_.isArray(a))s(a,i,u);else if(a.opt_labels)_.each(a.opt_labels,function(t){var e=Backbone.$("<optgroup/>").attr("label",t);s(a[t],e,u),i.append(e)});else{var h=[],r;for(var l in a)r={},r[e.valuePath]=l,r[e.labelPath]=a[l],h.push(r);s(_.sortBy(h,e.comparator||e.labelPath),i,u)}},getVal:function(t){var e;return e=t.prop("multiple")?Backbone.$(r(t).map(function(){return Backbone.$(this).data("stickit_bind_val")})).get():r(t).data("stickit_bind_val")}}]),Backbone.Stickit=e,Backbone.Stickit});