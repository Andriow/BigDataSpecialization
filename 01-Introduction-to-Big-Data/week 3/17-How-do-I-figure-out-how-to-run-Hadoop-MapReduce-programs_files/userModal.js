define("bundles/userModal/views/userModal",["require","exports","module","jquery","origami","jsuri","bundles/phoenix/lib/multitrackerMixin","bundles/phoenix/lib/view","bundles/userModal/lib/instrumentation","bundles/userModal/models/userModal","bundles/userModal/views/userModal.html","js/lib/coursera.redirect","js/lib/modals","css!bundles/helpwidget/index","css!pages/open-course/common/styl/helpwidget","css!bundles/userModal/styl/userModal","js/lib/placeholder","js/lib/tooltips","bundles/userModal/views/signup","bundles/userModal/views/login","bundles/userModal/views/passwordResetRequest","bundles/userModal/views/passwordResetRequestSent","bundles/userModal/views/passwordResetConfirm","bundles/userModal/views/requestEmail","bundles/userModal/views/requestPassword"],function(require,exports,module){"use strict";var $=require("jquery"),h=require("origami"),l=require("jsuri"),u=require("bundles/phoenix/lib/multitrackerMixin"),s=require("bundles/phoenix/lib/view"),e=require("bundles/userModal/lib/instrumentation"),i=require("bundles/userModal/models/userModal"),d=require("bundles/userModal/views/userModal.html"),a=require("js/lib/coursera.redirect"),n=require("js/lib/modals");require("css!bundles/helpwidget/index"),require("css!pages/open-course/common/styl/helpwidget"),require("css!bundles/userModal/styl/userModal"),require("js/lib/placeholder"),require("js/lib/tooltips");var o="c-user-modal",t="."+o,r=s.extend({name:"userModal",stateModelProperty:"model",multitracker:{namespace:"userModal"},template:d,subregions:{signup:{"bundles/userModal/views/signup":{to:'[data-js="signup-body"]',module:require("bundles/userModal/views/signup")}},login:{"bundles/userModal/views/login":{to:'[data-js="login-body"]',module:require("bundles/userModal/views/login")}},passwordResetRequest:{"bundles/userModal/views/passwordResetRequest":{to:'[data-js="password-reset-request-body"]',module:require("bundles/userModal/views/passwordResetRequest")}},passwordResetRequestSent:{"bundles/userModal/views/passwordResetRequestSent":{to:'[data-js="password-reset-request-sent-body"]',module:require("bundles/userModal/views/passwordResetRequestSent")}},passwordResetConfirm:{"bundles/userModal/views/passwordResetConfirm":{to:'[data-js="password-reset-confirm-body"]',module:require("bundles/userModal/views/passwordResetConfirm")}},requestEmail:{"bundles/userModal/views/requestEmail":{to:'[data-js="request-email-body"]',module:require("bundles/userModal/views/requestEmail")}},requestPassword:{"bundles/userModal/views/requestPassword":{to:'[data-js="request-password-body"]',module:require("bundles/userModal/views/requestPassword")}}},initialize:function initialize(e){this.userModal=null,this.onModelClose=null,this.model=i,this.listenTo(this,"view:appended",this.onViewAppended.bind(this))},updateLocationForAuthMode:function updateLocationForAuthMode(s){var o=window.location.href,e=new l(o);switch(e.deleteQueryParam("authMode"),s){case"login":case"signup":e.addQueryParam("authMode",s)}var t=e.toString();t!==o&&a.replaceUrl(t)},onViewAppended:function onViewAppended(){if(this.$("input[placeholder]").placeholder(),!this.userModal){var e=!0;window.matchMedia&&window.matchMedia("(max-width: 480px)").matches&&(e=!1),this.userModal=n(this.$(t),{autofocus:e,"overlay.class":"c-user-modal-overlay"}),this.userModal.on("close",this.onModalClose.bind(this)),"hidden"!==this.model.state()&&this.openModal(),this.listenTo(this.model,"state:enter:hidden",this.closeModal.bind(this)),this.listenTo(this.model,"state:exit:hidden",this.openModal.bind(this))}},remove:function remove(){this.userModal&&this.userModal.off("close",this.onModalClose),s.prototype.remove.call(this)},onModalClose:function onModalClose(){this.model.transitionIfNot("hidden")},openModal:function openModal(){this.renderState(),this.userModal.open(),this.$el.hasClass(o)||(this.$el=$(t)),this.$el.on("click","[data-js~=user-modal-nav-link]",this.onNavLinkClick.bind(this))},closeModal:function closeModal(){this.$el.off("click","[data-js~=user-modal-nav-link]"),this.updateLocationForAuthMode(null),this.userModal.close(),e.closeModal()},renderState:function renderState(){s.prototype.renderState.call(this),this.$$("user-modal-nav-link").removeClass("active"),this.$('header [data-target-state~="'+this.model.state()+'"]').addClass("active")},show:function show(e){this.updateLocationForAuthMode(e),this.model.transitionIfNot(e)},hide:function hide(){this.updateLocationForAuthMode(null),this.model.transition("hidden")},onNavLinkClick:function onNavLinkClick(o){var t=$(o.currentTarget),s=t.attr("data-target-state");switch(this.show(s),s){case"login":e.loginLinkClick();break;case"signup":e.signupLinkClick();break;case"password-reset-request":e.passwordResetRequestLinkClick()}}});module.exports=r.extend(u)});